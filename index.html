<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>Tetris Mobile</title>

<style>
    body {
        margin: 0;
        background: #111;
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        font-family: Arial, sans-serif;
        -webkit-user-select: none;
        user-select: none;
    }

    #game {
        background: #222;
        margin-top: 10px;
    }

    /* Mobile buttons */
    .controls {
        display: flex;
        gap: 10px;
        margin-top: 15px;
    }

    .btn {
        background: #444;
        border: 1px solid #888;
        border-radius: 10px;
        padding: 18px 22px;
        font-size: 20px;
        color: white;
        text-align: center;
        width: 70px;
        touch-action: manipulation;
    }

    .btn:active {
        background: #666;
    }
</style>
</head>
<body>

<canvas id="game" width="240" height="480"></canvas>

<div class="controls">
    <div class="btn" id="left">←</div>
    <div class="btn" id="rotate">⟳</div>
    <div class="btn" id="right">→</div>
    <div class="btn" id="down">↓</div>
</div>

<script>
// ------------------------
// Canvas + Game Settings
// ------------------------
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const COLS = 10;
const ROWS = 20;
const BLOCK = 24;

// Auto-resize for iPhone safely
function resizeCanvas() {
    const scale = Math.min(
        window.innerWidth / canvas.width,
        (window.innerHeight - 120) / canvas.height
    );
    canvas.style.transform = `scale(${scale})`;
}
resizeCanvas();
window.onresize = resizeCanvas;

// ------------------------
// Game Logic
// ------------------------
function emptyBoard() {
    return Array.from({ length: ROWS }, () => Array(COLS).fill(0));
}
let board = emptyBoard();

const pieces = "IJLOSTZ";
const colors = {
    I: "cyan", J: "blue", L: "orange", O: "yellow",
    S: "green", T: "purple", Z: "red"
};
const shapes = {
    I: [[1,1,1,1]],
    J: [[1,0,0],[1,1,1]],
    L: [[0,0,1],[1,1,1]],
    O: [[1,1],[1,1]],
    S: [[0,1,1],[1,1,0]],
    T: [[0,1,0],[1,1,1]],
    Z: [[1,1,0],[0,1,1]]
};

class Piece {
    constructor(type) {
        this.type = type;
        this.shape = shapes[type];
        this.color = colors[type];
        this.x = 3;
        this.y = 0;
    }
}

let current = new Piece(randomPiece());

function randomPiece() {
    return pieces[Math.floor(Math.random() * pieces.length)];
}

function drawBlock(x, y, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x * BLOCK, y * BLOCK, BLOCK - 1, BLOCK - 1);
}

function drawBoard() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    board.forEach((row, y) => {
        row.forEach((cell, x) => {
            if (cell) drawBlock(x, y, cell);
        });
    });
    current.shape.forEach((row, dy) => {
        row.forEach((val, dx) => {
            if (val) drawBlock(current.x + dx, current.y + dy, current.color);
        });
    });
}

function collision(x, y, shape) {
    return shape.some((row, dy) =>
        row.some((val, dx) => {
            if (!val) return false;
            let nx = x + dx;
            let ny = y + dy;
            return (
                ny >= ROWS ||
                nx < 0 ||
                nx >= COLS ||
                (ny >= 0 && board[ny][nx])
            );
        })
    );
}

function merge() {
    current.shape.forEach((row, dy) => {
        row.forEach((val, dx) => {
            if (val) board[current.y + dy][current.x + dx] = current.color;
        });
    });
}

function rotate(matrix) {
    const N = matrix.length;
    return matrix[0].map((_, i) => matrix.map(r => r[i])).reverse();
}

function drop() {
    if (!collision(current.x, current.y + 1, current.shape)) {
        current.y++;
    } else {
        merge();
        clearLines();
        current = new Piece(randomPiece());
        if (collision(current.x, current.y, current.shape)) {
            board = emptyBoard(); // simple reset
        }
    }
    drawBoard();
}

function clearLines() {
    board = board.filter(row => row.some(cell => !cell));
    while (board.length < ROWS) board.unshift(Array(COLS).fill(0));
}

// ------------------------
// Controls
// ------------------------
function moveLeft() {
    if (!collision(current.x - 1, current.y, current.shape)) current.x--;
    drawBoard();
}
function moveRight() {
    if (!collision(current.x + 1, current.y, current.shape)) current.x++;
    drawBoard();
}
function rotatePiece() {
    const newShape = rotate(current.shape);
    if (!collision(current.x, current.y, newShape)) current.shape = newShape;
    drawBoard();
}
function softDrop() {
    drop();
}

// Touch buttons
document.getElementById("left").ontouchstart = moveLeft;
document.getElementById("right").ontouchstart = moveRight;
document.getElementById("rotate").ontouchstart = rotatePiece;
document.getElementById("down").ontouchstart = softDrop;

// Keyboard (optional)
document.addEventListener("keydown", (e) => {
    if (e.key === "ArrowLeft") moveLeft();
    if (e.key === "ArrowRight") moveRight();
    if (e.key === "ArrowUp") rotatePiece();
    if (e.key === "ArrowDown") softDrop();
});

// Game Loop
setInterval(drop, 600);
drawBoard();
</script>

</body>
</html>
