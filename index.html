<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Tetris — Full Controls</title>
<style>
  :root{--bg:#111;--panel:#222;--muted:#888}
  html,body{
    height:100dvh;
    margin:0;
    overflow:hidden; /* REMOVE SCROLL */
    background:var(--bg);
    color:#fff;
    font-family:system-ui,-apple-system,Segoe UI,Roboto;
  }
  header{background:var(--panel);padding:12px;text-align:center}
  h1{margin:0;font-size:20px}
  #score{margin-top:6px;font-size:15px;color:var(--muted)}

  #game-wrap{
    display:flex;
    height:calc(100dvh - 200px);
    align-items:center;
    justify-content:center;
    padding:12px;
    box-sizing:border-box;
  }

  #game-container{
    width:100%;
    max-width:420px;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
  }

  canvas{
    background:var(--panel);
    display:block;
    border-radius:6px;
    touch-action:none;
  }

  /* GAME CONTROL BAR */
  #game-buttons{
    display:flex;
    justify-content:center;
    gap:12px;
    padding:8px;
    background:#0003;
  }
  .gbtn{
    padding:10px 14px;
    font-size:15px;
    border:0;
    border-radius:8px;
    background:#444;
    color:#fff;
  }
  .gbtn:active{background:#666}

  /* MOVEMENT CONTROLS */
  #controls{
    position:fixed;
    left:0; right:0;
    bottom:8px;
    display:flex;
    justify-content:space-around;
    padding:10px 16px;
    gap:12px;
    background:rgba(0,0,0,0.25);
  }
  .btn{
    width:68px;height:68px;
    border-radius:12px;
    border:0;
    background:#444;
    color:#fff;
    font-size:26px;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .btn:active{background:#666}

  @media(min-width:900px){
    #controls{position:static;margin:12px 0}
    #game-wrap{height:calc(100vh - 240px)}
  }
</style>
</head>
<body>

<header>
  <h1>TETRIS</h1>
  <div id="score">Score: 0</div>
</header>

<!-- TOP GAME BUTTONS -->
<div id="game-buttons">
  <button class="gbtn" id="startBtn">Start</button>
  <button class="gbtn" id="pauseBtn">Pause</button>
  <button class="gbtn" id="restartBtn">Restart</button>
  <button class="gbtn" id="endBtn">End</button>
</div>

<div id="game-wrap">
  <div id="game-container">
    <canvas id="board" role="application" aria-label="Tetris board"></canvas>
  </div>
</div>

<div id="controls">
  <button class="btn" id="left">←</button>
  <button class="btn" id="rotate">⟳</button>
  <button class="btn" id="right">→</button>
  <button class="btn" id="down">↓</button>
</div>

<script>
/* ========= CONFIG ========= */
const COLS = 12, ROWS = 20;
const PADDING = 12;
const MAX_CANVAS_WIDTH = 420;
const MIN_CELL = 18;

/* ========= DOM ========= */
const canvas = document.getElementById('board');
const ctx = canvas.getContext('2d', {alpha:false});
const scoreEl = document.getElementById('score');
const container = document.getElementById('game-container');

/* GAME CONTROL BUTTONS */
const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const restartBtn = document.getElementById('restartBtn');
const endBtn = document.getElementById('endBtn');

/* ========= STATE ========= */
let arena, player;
let dropCounter = 0, dropInterval = 700, lastTime = 0;
let running = false;
let paused = false;
let ended = false;

/* ========= COLORS ========= */
const COLORS = [null,'#f1c40f','#e67e22','#9b59b6','#3498db','#1abc9c','#e74c3c','#2ecc71'];

/* ========= UTILITIES ========= */
const createMatrix = (w,h)=>Array.from({length:h},()=>Array(w).fill(0));

function randPiece(){
  return 'ILJOTSZ'[Math.floor(Math.random()*7)];
}

function createPiece(t){
  if(t==='T') return [[0,1,0],[1,1,1]];
  if(t==='O') return [[2,2],[2,2]];
  if(t==='L') return [[0,0,3],[3,3,3]];
  if(t==='J') return [[4,0,0],[4,4,4]];
  if(t==='I') return [[0,5,0,0],[0,5,0,0],[0,5,0,0],[0,5,0,0]];
  if(t==='S') return [[0,6,6],[6,6,0],[0,0,0]];
  if(t==='Z') return [[7,7,0],[0,7,7],[0,0,0]];
}

/* ========= DRAW ========= */
let cellW=20, cellH=20;

function resizeCanvas(){
  const rect = container.getBoundingClientRect();
  let availH = rect.height - (PADDING*2);
  let availW = Math.min(rect.width - (PADDING*2), MAX_CANVAS_WIDTH);

  const base = Math.max(
      Math.min( Math.floor(availH/ROWS), Math.floor(availW/COLS) ),
      MIN_CELL
  );

  const W = base*COLS, H = base*ROWS;
  canvas.style.width=W+'px'; canvas.style.height=H+'px';
  canvas.width=W; canvas.height=H;

  cellW = W/COLS; cellH = H/ROWS;
  ctx.imageSmoothingEnabled = false;
  draw();
}

function draw(){
  ctx.fillStyle='#222';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  for(let y=0;y<ROWS;y++){
    for(let x=0;x<COLS;x++){
      if(arena[y][x]) drawCell(x,y,COLORS[arena[y][x]]);
    }
  }

  if(player.matrix){
    for(let y=0;y<player.matrix.length;y++){
      for(let x=0;x<player.matrix[y].length;x++){
        if(player.matrix[y][x]){
          drawCell(x+player.pos.x, y+player.pos.y, COLORS[player.matrix[y][x]]);
        }
      }
    }
  }
}

function drawCell(x,y,color){
  if(y<0) return;
  ctx.fillStyle=color;
  ctx.fillRect(x*cellW+1,y*cellH+1,cellW-2,cellH-2);
}

/* ========= COLLISION ========= */
function collide(arena,pl){
  const m=pl.matrix,o=pl.pos;
  for(let y=0;y<m.length;y++){
    for(let x=0;x<m[y].length;x++){
      if(m[y][x] &&
        (o.y+y>=ROWS || o.x+x<0 || o.x+x>=COLS || arena[o.y+y][o.x+x])){
          return true;
      }
    }
  }
  return false;
}

/* ========= MERGE + SCORE ========= */
function mergePlayer(){
  player.matrix.forEach((row,y)=>{
    row.forEach((v,x)=>{
      if(v && player.pos.y+y>=0) arena[player.pos.y+y][player.pos.x+x]=v;
    });
  });
}

function sweep(){
  let lines=0;
  outer: for(let y=ROWS-1;y>=0;y--){
    for(let x=0;x<COLS;x++){
      if(!arena[y][x]) continue outer;
    }
    arena.splice(y,1);
    arena.unshift(Array(COLS).fill(0));
    lines++;
    y++;
  }
  if(lines){
    player.score+=lines*10;
    scoreEl.textContent="Score: "+player.score;
  }
}

/* ========= PLAYER ========= */
function playerReset(){
  player.matrix=createPiece(randPiece());
  player.pos.x=Math.floor(COLS/2 - player.matrix[0].length/2);
  player.pos.y=-2;

  if(collide(arena,player)){
    arena=createMatrix(COLS,ROWS);
    player.score=0;
    scoreEl.textContent="Score: 0";
  }
}

function playerDrop(){
  player.pos.y++;
  if(collide(arena,player)){
    player.pos.y--;
    mergePlayer();
    sweep();
    playerReset();
  }
  dropCounter=0;
}

function playerMove(d){
  player.pos.x+=d;
  if(collide(arena,player)) player.pos.x-=d;
}

function rotateMatrix(m){
  for(let y=0;y<m.length;y++)
    for(let x=0;x<y;x++)
      [m[x][y], m[y][x]]=[m[y][x],m[x][y]];
  m.forEach(r=>r.reverse());
}

function playerRotate(){
  const clone=player.matrix.map(r=>r.slice());
  rotateMatrix(player.matrix);
  const kicks=[0,-1,1,-2,2];
  const oldX=player.pos.x;
  for(let k of kicks){
    player.pos.x=oldX+k;
    if(!collide(arena,player)) return;
  }
  player.matrix=clone;
  player.pos.x=oldX;
}

/* ========= GAME LOOP ========= */
function update(time=0){
  if(!running || paused || ended) return;

  const delta=time-lastTime;
  lastTime=time;

  dropCounter+=delta;
  if(dropCounter>dropInterval) playerDrop();

  draw();
  requestAnimationFrame(update);
}

/* ========= GAME CONTROL FUNCTIONS ========= */
function startGame(){
  if(ended) return; // must restart if ended
  if(running) return;

  running=true;
  paused=false;
  lastTime=performance.now();
  requestAnimationFrame(update);
}

function pauseGame(){
  if(!running || ended) return;
  paused=!paused;
  pauseBtn.textContent = paused ? "Resume" : "Pause";
  if(!paused) requestAnimationFrame(update);
}

function endGame(){
  ended=true;
  running=false;
  paused=false;
  pauseBtn.textContent="Pause";
}

function restartGame(){
  arena=createMatrix(COLS,ROWS);
  player={pos:{x:0,y:0},matrix:null,score:0};
  scoreEl.textContent="Score: 0";
  dropCounter=0;
  ended=false;
  paused=false;
  running=false;
  pauseBtn.textContent="Pause";
  playerReset();
  draw();
}

/* ========= INPUTS ========= */
function bindButton(id,fn){
  const el=document.getElementById(id);
  el.addEventListener('touchstart',e=>{e.preventDefault();fn();},{passive:false});
  el.addEventListener('mousedown',e=>{e.preventDefault();fn();});
}
bindButton('left',()=>playerMove(-1));
bindButton('right',()=>playerMove(1));
bindButton('down',()=>playerDrop());
bindButton('rotate',()=>playerRotate());

window.addEventListener('keydown',e=>{
  if(!running || paused) return;
  switch(e.code){
    case 'ArrowLeft': playerMove(-1); break;
    case 'ArrowRight': playerMove(1); break;
    case 'ArrowDown': playerDrop(); break;
    case 'ArrowUp': playerRotate(); break;
    case 'Enter': hardDrop(); break;
  }
});

function hardDrop(){
  while(!collide(arena,player)) player.pos.y++;
  player.pos.y--;
  mergePlayer(); sweep(); playerReset();
}

/* BUTTON WIRING */
startBtn.onclick=startGame;
pauseBtn.onclick=pauseGame;
restartBtn.onclick=restartGame;
endBtn.onclick=endGame;

/* ========= INIT ========= */
function init(){
  arena=createMatrix(COLS,ROWS);
  player={pos:{x:0,y:0},matrix:null,score:0};
  playerReset();
  resizeCanvas();
  draw();
}

let resizeId=null;
window.addEventListener('resize',()=>{
  clearTimeout(resizeId);
  resizeId=setTimeout(resizeCanvas,80);
});

document.addEventListener('touchstart',e=>{
  if(e.touches.length>1) e.preventDefault();
},{passive:false});

init();
</script>
</body>
</html>
