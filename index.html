<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>TETRIS</title>
<style>
  :root{--bg:#0d0d0d;--panel:#1a1a1a;--accent:#00d0ff}
  html,body{margin:0;height:100%;background:var(--bg);color:#fff;font-family:system-ui;overflow:hidden}
  body{display:flex;flex-direction:column}
  header{background:var(--panel);padding:14px;text-align:center;position:relative}
  h1{margin:0;font-size:22px}
  #score{font-size:16px;margin-top:6px;color:#aaa}
  #game-wrap{flex:1;display:flex;justify-content:center;align-items:center;padding:8px 8px 80px;box-sizing:border-box}
  #game-container{width:100%;max-width:420px;height:100%;display:flex;justify-content:center;align-items:center}
  canvas{background:#111;border-radius:12px;box-shadow:0 10px 30px #000;display:block}
  #controls{position:fixed;bottom:0;left:0;right:0;background:rgba(0,0,0,0.9);padding:12px;display:flex;justify-content:space-around;gap:10px}
  .btn{width:66px;height:66px;border-radius:14px;border:0;background:#333;color:#fff;font-size:28px;display:flex;align-items:center;justify-content:center;touch-action:manipulation}
  .btn:active,.btn.active{background:var(--accent)}
  #restartBtn{background:#e74c3c}
  #restartBtn:active{background:#c0392b}
  #overlay{
    position:absolute;inset:0;background:rgba(0,0,0,0.9);
    display:flex;flex-direction:column;justify-content:center;align-items:center;
    font-size:28px;z-index:10;transition:opacity .4s
  }
  #overlay.hidden{opacity:0;pointer-events:none}
  @media(min-width:768px){
    #controls{position:static;margin-top:12px;background:none;padding:0}
  }
</style>
</head>
<body>

<header>
  <h1>TETRIS</h1>
  <div id="score">Score: 0</div>
</header>

<div id="game-wrap">
  <div id="game-container">
    <canvas id="board"></canvas>

    <!-- Start / Game Over / Pause overlay -->
    <div id="overlay">
      <div id="overlayTitle">TETRIS</div>
      <div id="overlayMsg">Tap or Press Any Key to Start</div>
      <div id="finalScore" style="display:none;font-size:22px;margin-top:20px"></div>
    </div>
  </div>
</div>

<div id="controls">
  <button class="btn" id="left">Left Arrow</button>
  <button class="btn" id="rotate">Rotate</button>
  <button class="btn" id="right">Right Arrow</button>
  <button class="btn" id="down">Down Arrow</button>
  <button class="btn" id="restartBtn">Restart</button>
</div>

<script>
/* ====================== CONFIG ====================== */
const COLS = 12, ROWS = 20;
const canvas = document.getElementById('board');
const ctx = canvas.getContext('2d', {alpha:false});
const scoreEl = document.getElementById('score');
const overlay = document.getElementById('overlay');
const overlayTitle = document.getElementById('overlayTitle');
const overlayMsg = document.getElementById('overlayMsg');
const finalScoreEl = document.getElementById('finalScore');

/* ====================== STATE ====================== */
let arena = createMatrix(COLS, ROWS);
let player = {pos:{x:0,y:0}, matrix:null, score:0};
let dropCounter = 0, dropInterval = 800, lastTime = 0;
let gameRunning = false, gamePaused = false, gameOver = false;

/* ====================== COLORS ====================== */
const COLORS = [null,'#f1c40f','#e67e22','#9b59b6','#3498db','#1abc9c','#e74c3c','#2ecc71'];

/* ====================== UTILS ====================== */
function createMatrix(w,h){ return Array.from({length:h},()=>Array(w).fill(0));
function randPiece(){ const p='ILJOTSZ'; return p[Math.floor(Math.random()*p.length)]; }
function createPiece(t){
  if(t==='I') return [[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]];
  if(t==='O') return [[2,2],[2,2]];
  if(t==='T') return [[0,3,0],[3,3,3]];
  if(t==='L') return [[0,0,4],[4,4,4]];
  if(t==='J') return [[5,0,0],[5,5,5]];
  if(t==='S') return [[0,6,6],[6,6,0]];
  if(t==='Z') return [[7,7,0],[0,7,7]];
}

/* ====================== DRAW & RESIZE ====================== */
let cellSize = 20;
function resize(){
  const rect = document.getElementById('game-container').getBoundingClientRect();
  const maxW = Math.min(rect.width, 420);
  const maxH = rect.height;
  const size = Math.max(Math.min(maxW/COLS, maxH/ROWS), 18);
  const w = size * COLS, h = size * ROWS;
  canvas.style.width = w + 'px';
  canvas.style.height = h + 'px';
  canvas.width = w; canvas.height = h;
  cellSize = size;
  draw();
}
window.addEventListener('resize',()=>setTimeout(resize,100));
resize();

/* ====================== GAME LOGIC ====================== */
function draw(){
  ctx.fillStyle = '#111';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  // locked blocks
  arena.forEach((row,y)=>row.forEach((v,x)=>{
    if(v) drawCell(x,y,COLORS[v]);
  }));
  // current piece
  if(player.matrix){
    player.matrix.forEach((row,y)=>row.forEach((v,x=>{
      if(v) drawCell(player.pos.x+x, player.pos.y+y, COLORS[v]);
    }));
  }
}
function drawCell(x,y,color){
  if(y<0) return;
  const s = cellSize;
  ctx.fillStyle = color;
  ctx.fillRect(x*s+1, y*s+1, s-2, s-2);
}
function collide(){
  const m=player.matrix, o=player.pos;
  for(let y=0;y<m.length;y++)for(let x=0;x<m[y].length;x++){
    if(m[y][x] && (arena[y+o.y] && arena[y+o.y][x+o.x])!==0) return true;
  }
  return o.y+m.length>ROWS || o.x<0 || o.x+m[0].length>COLS;
}
function merge(){
  player.matrix.forEach((row,y)=>row.forEach((v,x)=>{
    if(v && player.pos.y+y>=0) arena[player.pos.y+y][player.pos.x+x]=v;
  }));
}
function sweep(){
  let lines=0;
  outer:for(let y=ROWS-1;y>=0;y--){
    for(let x=0;x<COLS;x++) if(!arena[y][x]) continue outer;
    arena.splice(y,1);
    arena.unshift(new Array(COLS).fill(0));
    lines++;
  }
  if(lines) player.score += lines*100;
}
function playerReset(){
  const type = randPiece();
  player.matrix = createPiece(type);
  player.pos.x = Math.floor((COLS-player.matrix[0].length)/2);
  player.pos.y = 0;
  if(collide()){
    arena = createMatrix(COLS,ROWS);
    player.score = 0;
    gameOver = true;
    showOverlay("GAME OVER",`Score: ${player.score}<br>Tap or Space to Restart`);
  }
}
function drop(){
  player.pos.y++;
  if(collide()){
    player.pos.y--;
    merge();
    sweep();
    playerReset();
  }
  dropCounter=0;
}
function hardDrop(){
  while(!collide()) player.pos.y++;
  player.pos.y--;
  merge();
  sweep();
  playerReset();
  dropCounter=0;
}
function move(dir){
  player.pos.x += dir;
  if(collide()) player.pos.x -= dir;
}
function rotate(){
  const original = player.matrix.map(r=>r.slice());
  const oldX = player.pos.x;
  // transpose + reverse
  for(let y=0;y<player.matrix.length;y++)
    for(let x=0;x<y;x++)
      [player.matrix[x][y],player.matrix[y][x]] = [player.matrix[y][x],player.matrix[x][y]];
  player.matrix.forEach(r=>r.reverse());
  // simple wall kick
  const kicks = [0,-1,1,-2,2];
  for(const k of kicks){
    player.pos.x = oldX + k;
    if(!collide()) return;
  }
  player.matrix = original;
  player.pos.x = oldX;
}
function updateScore(){ scoreEl.textContent = `Score: ${player.score}`; }

/* ====================== INPUT ====================== */
document.getElementById('left').onclick = ()=>move(-1);
document.getElementById('right').onclick = ()=>move(1);
document.getElementById('down').onclick = ()=>drop();
document.getElementById('rotate').onclick = ()=>rotate();
document.getElementById('restartBtn').onclick = restart;

document.addEventListener('keydown',e=>{
  if(gameOver || !gameRunning) return;
  if(e.code==='ArrowLeft') move(-1);
  if(e.code==='ArrowRight') move(1);
  if(e.code==='ArrowDown') drop();
  if(e.code==='ArrowUp' || e.code==='Space') { e.preventDefault(); rotate(); }
  if(e.code==='Enter') hardDrop();
  if(e.code==='KeyP') togglePause();
});

/* ====================== OVERLAY & GAME STATE ====================== */
function showOverlay(title,msg=''){
  overlayTitle.textContent = title;
  overlayMsg.innerHTML = msg;
  finalScoreEl.style.display = gameOver ? 'block' : 'none';
  if(gameOver) finalScoreEl.innerHTML = `Score: ${player.score}`;
  overlay.classList.remove('hidden');
}
function hideOverlay(){ overlay.classList.add('hidden'); }
function togglePause(){
  if(gameOver) return;
  gamePaused = !gamePaused;
  overlayTitle.textContent = gamePaused ? 'PAUSED' : 'TETRIS';
  overlayMsg.textContent = gamePaused ? 'Press P or tap to resume' : '';
  overlay.classList.toggle('hidden', !gamePaused);
}
function startGame(){
  if(gameRunning && !gameOver) return;
  gameRunning = true;
  gamePaused = false;
  gameOver = false;
  arena = createMatrix(COLS,ROWS);
  player.score = 0;
  updateScore();
  playerReset();
  hideOverlay();
  lastTime = performance.now();
  requestAnimationFrame(gameLoop);
}
function restart(){
  startGame();
}

/* Tap / click anywhere also starts/resumes */
canvas.onclick = startGame;
overlay.onclick = startGame;

/* ====================== MAIN LOOP ====================== */
function gameLoop(time=0){
  if(!gameRunning || gamePaused){ requestAnimationFrame(gameLoop); return; }
  const delta = time - lastTime;
  lastTime = time;
  dropCounter += delta;
  if(dropCounter > dropInterval) drop();
  draw();
  requestAnimationFrame(gameLoop);
}

/* Start screen */
showOverlay('TETRIS','Tap screen or press any key');
</script>
</body>
</html>
